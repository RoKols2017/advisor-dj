---
title: "–ß–µ–∫–ª–∏—Å—Ç —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –¥–ª—è –õ–í–° –±–µ–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞"
type: deployment
date: 2025-01-30
owner: "@rom"
---

# –ß–µ–∫–ª–∏—Å—Ç —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è Print Advisor –≤ –õ–í–° –±–µ–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞

## ‚úÖ –ß—Ç–æ —É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

### 1. Docker-–∫–æ–º–ø–æ–∑–∏—Ü–∏—è
- ‚úÖ `docker-compose.yml` –Ω–∞—Å—Ç—Ä–æ–µ–Ω —Å —Ç—Ä–µ–º—è —Å–µ—Ä–≤–∏—Å–∞–º–∏: `web`, `watcher`, `db`
- ‚úÖ PostgreSQL –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–∞—Å—Ç—Ä–æ–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç
- ‚úÖ –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã —Å–≤—è–∑–∞–Ω—ã —á–µ—Ä–µ–∑ –≤–Ω—É—Ç—Ä–µ–Ω–Ω—é—é —Å–µ—Ç—å `advisor-network`
- ‚úÖ Health checks –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã –¥–ª—è –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤

### 2. PostgreSQL
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –æ–±—Ä–∞–∑ `postgres:15`
- ‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è (`POSTGRES_DB`, `POSTGRES_USER`, `POSTGRES_PASSWORD`)
- ‚úÖ –î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ volume `pgdata`
- ‚úÖ Django –Ω–∞—Å—Ç—Ä–æ–µ–Ω –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ PostgreSQL —á–µ—Ä–µ–∑ `DATABASE_URL`

### 3. Watcher (–¥–µ–º–æ–Ω –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ –∫–∞—Ç–∞–ª–æ–≥–∞)
- ‚úÖ –°–µ—Ä–≤–∏—Å `watcher` —Å–ª–µ–¥–∏—Ç –∑–∞ –∫–∞—Ç–∞–ª–æ–≥–æ–º `/app/data/watch`
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç:
  - **JSON-—Ñ–∞–π–ª—ã** ‚Üí –∏–º–ø–æ—Ä—Ç —Å–æ–±—ã—Ç–∏–π –ø–µ—á–∞—Ç–∏
  - **CSV-—Ñ–∞–π–ª—ã** ‚Üí –∏–º–ø–æ—Ä—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ –ü–µ—Ä–µ–º–µ—â–∞–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã –≤ `/app/data/processed`
- ‚úÖ –ü–µ—Ä–µ–º–µ—â–∞–µ—Ç —Ñ–∞–π–ª—ã —Å –æ—à–∏–±–∫–∞–º–∏ –≤ `/app/data/quarantine`
- ‚úÖ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö –¥–µ–π—Å—Ç–≤–∏–π

### 4. –ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
- ‚úÖ –ò–º–ø–æ—Ä—Ç —Å–æ–±—ã—Ç–∏–π –ø–µ—á–∞—Ç–∏ –∏–∑ JSON (`printing/services.py::import_print_events`)
- ‚úÖ –ò–º–ø–æ—Ä—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ CSV (`printing/services.py::import_users_from_csv_stream`)
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
- ‚úÖ –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è –ø–æ `job_id` –¥–ª—è —Å–æ–±—ã—Ç–∏–π –ø–µ—á–∞—Ç–∏

---

## ‚ö†Ô∏è –ß—Ç–æ –Ω—É–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å Windows-—Å–µ—Ä–≤–µ—Ä–æ–º

### 1. –ú–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–µ—Ç–µ–≤–æ–π –ø–∞–ø–∫–∏ –≤ Docker

**–ü—Ä–æ–±–ª–µ–º–∞:** –¢–µ–∫—É—â–∏–π `docker-compose.yml` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Docker volume `data`, –∫–æ—Ç–æ—Ä—ã–π —Å–æ–∑–¥–∞–µ—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ. –î–ª—è —Ä–∞–±–æ—Ç—ã —Å —Ñ–∞–π–ª–∞–º–∏ —Å Windows-—Å–µ—Ä–≤–µ—Ä–∞ –Ω—É–∂–Ω–æ –ø—Ä–∏–º–æ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å —Å–µ—Ç–µ–≤—É—é –ø–∞–ø–∫—É.

**–†–µ—à–µ–Ω–∏–µ:** –î–æ–±–∞–≤–∏—Ç—å bind mount –¥–ª—è –∫–∞—Ç–∞–ª–æ–≥–∞ watch.

**–í–∞—Ä–∏–∞–Ω—Ç –ê: –ú–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–µ—Ç–µ–≤–æ–π –ø–∞–ø–∫–∏ –Ω–∞ —Ö–æ—Å—Ç-—Å–∏—Å—Ç–µ–º—É, –∑–∞—Ç–µ–º –≤ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä**

1. –ù–∞ Linux —Ö–æ—Å—Ç–µ —Å–º–æ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å Windows-—à–∞—Ä—É (SMB/CIFS):
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å cifs-utils (–µ—Å–ª–∏ –Ω–µ—Ç)
sudo apt-get install cifs-utils

# –°–æ–∑–¥–∞—Ç—å —Ç–æ—á–∫—É –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
sudo mkdir -p /mnt/printshare

# –°–º–æ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å Windows-—à–∞—Ä—É
sudo mount -t cifs //windows-server/share /mnt/printshare \
  -o username=user,password=pass,uid=$(id -u),gid=$(id -g),iocharset=utf8

# –ò–ª–∏ –¥–æ–±–∞–≤–∏—Ç—å –≤ /etc/fstab –¥–ª—è –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞:
//windows-server/share /mnt/printshare cifs username=user,password=pass,uid=1000,gid=1000,iocharset=utf8 0 0
```

2. –û–±–Ω–æ–≤–∏—Ç—å `docker-compose.yml`:
```yaml
watcher:
  volumes:
    - logs:/app/logs
    - /mnt/printshare:/app/data/watch:ro  # –¢–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
    - ./data/processed:/app/data/processed
    - ./data/quarantine:/app/data/quarantine
```

**–í–∞—Ä–∏–∞–Ω—Ç –ë: –ü—Ä—è–º–æ–µ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ Docker volume driver (—Ç—Ä–µ–±—É–µ—Ç –ø–ª–∞–≥–∏–Ω)**

–ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–ª–∞–≥–∏–Ω –¥–ª—è CIFS, –Ω–æ –≤–∞—Ä–∏–∞–Ω—Ç –ê –ø—Ä–æ—â–µ –∏ –Ω–∞–¥–µ–∂–Ω–µ–µ.

### 2. –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª–∞–º

**–ü—Ä–æ–±–ª–µ–º–∞:** –§–∞–π–ª—ã, —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å Windows-—Å–µ—Ä–≤–µ—Ä–∞, –º–æ–≥—É—Ç –∏–º–µ—Ç—å –¥—Ä—É–≥–∏–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞.

**–†–µ—à–µ–Ω–∏–µ:** 
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–ø—Ü–∏—é `uid` –∏ `gid` –ø—Ä–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ CIFS
- –ò–ª–∏ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å `user` –≤ docker-compose.yml –¥–ª—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è UID/GID

### 3. –†–∞–±–æ—Ç–∞ –±–µ–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞

**–í–∞–∂–Ω–æ:** Docker-–æ–±—Ä–∞–∑—ã –Ω—É–∂–Ω–æ —Å–æ–±—Ä–∞—Ç—å **–æ–¥–∏–Ω —Ä–∞–∑** –Ω–∞ –º–∞—à–∏–Ω–µ —Å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–æ–º, –∑–∞—Ç–µ–º —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Ü–µ–ª–µ–≤—É—é –º–∞—à–∏–Ω—É.

**–ü—Ä–æ—Ü–µ—Å—Å:**

1. **–ù–∞ –º–∞—à–∏–Ω–µ —Å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–æ–º:**
```bash
# –°–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑—ã
docker compose build

# –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ–±—Ä–∞–∑—ã –≤ –∞—Ä—Ö–∏–≤
docker save \
  advisor-dj-web:latest \
  advisor-dj-watcher:latest \
  postgres:15 \
  -o advisor-dj-images.tar

# –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Ü–µ–ª–µ–≤—É—é –º–∞—à–∏–Ω—É (—á–µ—Ä–µ–∑ USB/–ª–æ–∫–∞–ª—å–Ω—É—é —Å–µ—Ç—å)
scp advisor-dj-images.tar user@target-server:/tmp/
```

2. **–ù–∞ —Ü–µ–ª–µ–≤–æ–π –º–∞—à–∏–Ω–µ (–±–µ–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞):**
```bash
# –ó–∞–≥—Ä—É–∑–∏—Ç—å –æ–±—Ä–∞–∑—ã
docker load -i /tmp/advisor-dj-images.tar

# –ó–∞–ø—É—Å—Ç–∏—Ç—å –∫–æ–º–ø–æ–∑–∏—Ü–∏—é
docker compose up -d
```

**–ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–∞:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Docker Registry –≤ –ª–æ–∫–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏ (–µ—Å–ª–∏ –µ—Å—Ç—å).

### 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è

–°–æ–∑–¥–∞—Ç—å `.env` —Ñ–∞–π–ª –Ω–∞ —Ü–µ–ª–µ–≤–æ–π –º–∞—à–∏–Ω–µ:

```bash
# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
POSTGRES_DB=advisor
POSTGRES_USER=advisor
POSTGRES_PASSWORD=your-strong-password-here
POSTGRES_PORT=5432

# Django
DEBUG=0
SECRET_KEY=your-very-long-secret-key-here-min-50-chars
ALLOWED_HOSTS=your-server-ip,localhost,127.0.0.1
DJANGO_SETTINGS_MODULE=config.settings.docker

# –õ–æ–≥–∏
LOG_TO_FILE=1
LOG_TO_CONSOLE=0
LOG_DIR=/app/logs
LOG_FILE_NAME=project.log
WATCHER_LOG_FILE_NAME=print_events_watcher.log

# Watcher
PRINT_EVENTS_WATCH_DIR=/app/data/watch
PRINT_EVENTS_PROCESSED_DIR=/app/data/processed
PRINT_EVENTS_QUARANTINE_DIR=/app/data/quarantine
WATCHER_MAX_RETRIES=5
WATCHER_BACKOFF_BASE=2
WATCHER_BACKOFF_MAX=30
WATCHER_DEADLINE_SECONDS=300

# –ü–æ—Ä—Ç—ã
WEB_PORT=8000
```

---

## üìã –ü–æ—à–∞–≥–æ–≤–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è

### –≠—Ç–∞–ø 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –Ω–∞ –º–∞—à–∏–Ω–µ —Å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–æ–º

```bash
# 1. –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–æ–µ–∫—Ç
git clone <repository-url>
cd advisor-dj

# 2. –°–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑—ã
docker compose build

# 3. –°–æ–∑–¥–∞—Ç—å –∞—Ä—Ö–∏–≤ –æ–±—Ä–∞–∑–æ–≤
docker save \
  $(docker compose config --images) \
  -o advisor-dj-images.tar

# 4. –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ñ–∞–π–ª—ã –ø—Ä–æ–µ–∫—Ç–∞ –∏ –∞—Ä—Ö–∏–≤ –Ω–∞ —Ü–µ–ª–µ–≤—É—é –º–∞—à–∏–Ω—É
scp -r . user@target-server:/opt/advisor-dj/
scp advisor-dj-images.tar user@target-server:/opt/advisor-dj/
```

### –≠—Ç–∞–ø 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –Ω–∞ —Ü–µ–ª–µ–≤–æ–π –º–∞—à–∏–Ω–µ (–±–µ–∑ –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–∞)

```bash
# 1. –ó–∞–≥—Ä—É–∑–∏—Ç—å –æ–±—Ä–∞–∑—ã
cd /opt/advisor-dj
docker load -i advisor-dj-images.tar

# 2. –°–º–æ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å Windows-—à–∞—Ä—É (–µ—Å–ª–∏ –µ—â–µ –Ω–µ —Å–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∞)
sudo mkdir -p /mnt/printshare
sudo mount -t cifs //windows-server/printshare /mnt/printshare \
  -o username=service_account,password=password,uid=1000,gid=1000,iocharset=utf8

# 3. –û–±–Ω–æ–≤–∏—Ç—å docker-compose.yml –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Å–µ—Ç–µ–≤–æ–π –ø–∞–ø–∫–∏
# (—Å–º. —Ä–∞–∑–¥–µ–ª "–ú–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–µ—Ç–µ–≤–æ–π –ø–∞–ø–∫–∏" –≤—ã—à–µ)

# 4. –°–æ–∑–¥–∞—Ç—å .env —Ñ–∞–π–ª —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
cp .env.example .env
nano .env  # –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è

# 5. –°–æ–∑–¥–∞—Ç—å –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è processed –∏ quarantine
mkdir -p ./data/processed ./data/quarantine
chmod 755 ./data/processed ./data/quarantine

# 6. –ó–∞–ø—É—Å—Ç–∏—Ç—å —Å–µ—Ä–≤–∏—Å—ã
docker compose up -d

# 7. –í—ã–ø–æ–ª–Ω–∏—Ç—å –º–∏–≥—Ä–∞—Ü–∏–∏ –ë–î
docker compose exec web python manage.py migrate

# 6. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫ –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ —Å–∏—Å—Ç–µ–º—ã (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
sudo cp advisor-dj.service /etc/systemd/system/
sudo systemctl daemon-reload
sudo systemctl enable advisor-dj.service
sudo systemctl start advisor-dj.service

# 7. –°–æ–∑–¥–∞—Ç—å —Å—É–ø–µ—Ä–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
docker compose exec web python manage.py createsuperuser

# 8. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å
docker compose ps
docker compose logs -f watcher  # –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ watcher
```

### –≠—Ç–∞–ø 3: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã

1. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Å–µ—Ä–≤–∏—Å—ã –∑–∞–ø—É—â–µ–Ω—ã:**
```bash
docker compose ps
# –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –≤ —Å—Ç–∞—Ç—É—Å–µ "Up (healthy)"
```

2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ watcher:**
```bash
docker compose logs watcher | tail -20
# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å: "–°–ª–µ–∂–µ–Ω–∏–µ –∑–∞ /app/data/watch..."
```

3. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞:**
```bash
curl http://localhost:8000/health/
# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å {"status": "healthy", ...}
```

4. **–¢–µ—Å—Ç–æ–≤—ã–π –∏–º–ø–æ—Ä—Ç:**
   - –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π JSON-—Ñ–∞–π–ª —Å —Å–æ–±—ã—Ç–∏—è–º–∏ –≤ `/mnt/printshare/` (–∏–ª–∏ –≤ —Å–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω—É—é –ø–∞–ø–∫—É)
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ —Ñ–∞–π–ª –æ–±—Ä–∞–±–æ—Ç–∞–Ω:
   ```bash
   docker compose logs watcher | grep "–ó–∞–≥—Ä—É–∂–µ–Ω–æ"
   ls -la ./data/processed/  # –§–∞–π–ª –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –ø–µ—Ä–µ–º–µ—â–µ–Ω —Å—é–¥–∞
   ```

---

## üîß –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è docker-compose.yml

–î–ª—è —Ä–∞–±–æ—Ç—ã —Å Windows-—à–∞—Ä–æ–π –æ–±–Ω–æ–≤–∏—Ç—å —Å–µ–∫—Ü–∏—é `watcher`:

```yaml
watcher:
  build:
    context: .
    dockerfile: Dockerfile.watcher
  container_name: advisor-watcher
  environment:
    - DEBUG=${DEBUG:-0}
    - DJANGO_SETTINGS_MODULE=${DJANGO_SETTINGS_MODULE:-config.settings.docker}
    - SECRET_KEY=${SECRET_KEY}
    - DATABASE_URL=postgres://${POSTGRES_USER:-advisor}:${POSTGRES_PASSWORD:-advisor}@db:5432/${POSTGRES_DB:-advisor}
    - LOG_TO_FILE=${LOG_TO_FILE:-1}
    - LOG_TO_CONSOLE=${LOG_TO_CONSOLE:-0}
    - LOG_DIR=${LOG_DIR:-/app/logs}
    - WATCHER_LOG_FILE_NAME=${WATCHER_LOG_FILE_NAME:-print_events_watcher.log}
    - PRINT_EVENTS_WATCH_DIR=${PRINT_EVENTS_WATCH_DIR:-/app/data/watch}
    - PRINT_EVENTS_PROCESSED_DIR=${PRINT_EVENTS_PROCESSED_DIR:-/app/data/processed}
    - PRINT_EVENTS_QUARANTINE_DIR=${PRINT_EVENTS_QUARANTINE_DIR:-/app/data/quarantine}
  volumes:
    - logs:/app/logs
    # –ú–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–µ—Ç–µ–≤–æ–π –ø–∞–ø–∫–∏ —Å Windows-—Å–µ—Ä–≤–µ—Ä–∞ (—Ç–æ–ª—å–∫–æ —á—Ç–µ–Ω–∏–µ)
    - /mnt/printshare:/app/data/watch:ro
    # –õ–æ–∫–∞–ª—å–Ω—ã–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è processed –∏ quarantine
    - ./data/processed:/app/data/processed
    - ./data/quarantine:/app/data/quarantine
  depends_on:
    web:
      condition: service_healthy
    db:
      condition: service_healthy
  healthcheck:
    test: ["CMD", "pgrep", "-f", "printing.print_events_watcher"]
    interval: 30s
    timeout: 10s
    retries: 3
    start_period: 40s
  networks:
    - advisor-network
  restart: unless-stopped  # –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫ –≤—Å–µ—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** –í—Å–µ —Å–µ—Ä–≤–∏—Å—ã (`db`, `web`, `watcher`) –∏–º–µ—é—Ç –ø–æ–ª–∏—Ç–∏–∫—É `restart: unless-stopped` –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞. –î–ª—è –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞ –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ —Å–∏—Å—Ç–µ–º—ã –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ systemd unit —Ñ–∞–π–ª `advisor-dj.service`.

---

## ‚ö†Ô∏è –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞ 1: –§–∞–π–ª—ã –Ω–µ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—é—Ç—Å—è

**–ü—Ä–∏—á–∏–Ω—ã:**
- –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –Ω–∞ —Ñ–∞–π–ª—ã
- Watcher –Ω–µ –≤–∏–¥–∏—Ç —Ñ–∞–π–ª—ã –∏–∑-–∑–∞ –∑–∞–¥–µ—Ä–∂–∫–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏—è
- –§–∞–π–ª—ã –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω—ã Windows-—Å–µ—Ä–≤–µ—Ä–æ–º

**–†–µ—à–µ–Ω–∏–µ:**
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `:ro` (read-only) –¥–ª—è watch –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
- –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Ñ–∞–π–ª—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã (watcher —Ä–µ–∞–≥–∏—Ä—É–µ—Ç –Ω–∞ —Å–æ–±—ã—Ç–∏–µ `on_created`)
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å retry –ª–æ–≥–∏–∫—É (—É–∂–µ –µ—Å—Ç—å –≤ –∫–æ–¥–µ)

### –ü—Ä–æ–±–ª–µ–º–∞ 2: –ü–æ—Ç–µ—Ä—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ç–µ–≤–æ–π –ø–∞–ø–∫–æ–π

**–†–µ—à–µ–Ω–∏–µ:**
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –∞–≤—Ç–æ–ø–µ—Ä–µ–ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –≤ `/etc/fstab` —Å –æ–ø—Ü–∏—è–º–∏ `_netdev` –∏ `auto`
- –î–æ–±–∞–≤–∏—Ç—å –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ –ø–∞–ø–∫–∏
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `restart: unless-stopped` –¥–ª—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ (—É–∂–µ –µ—Å—Ç—å)

### –ü—Ä–æ–±–ª–µ–º–∞ 3: –ö–æ–¥–∏—Ä–æ–≤–∫–∞ —Ñ–∞–π–ª–æ–≤

**–†–µ—à–µ–Ω–∏–µ:**
- –ö–æ–¥ —É–∂–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `utf-8-sig` –¥–ª—è CSV –∏ JSON
- –£–±–µ–¥–∏—Ç—å—Å—è, —á—Ç–æ —Ñ–∞–π–ª—ã —Å Windows-—Å–µ—Ä–≤–µ—Ä–∞ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ UTF-8

### –ü—Ä–æ–±–ª–µ–º–∞ 4: –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –Ω–∞ –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–∞—Ö

**–†–µ—à–µ–Ω–∏–µ:**
- –¢–µ–∫—É—â–∏–π –∫–æ–¥ —É–∂–µ –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω (–±–∞—Ç—á–∏–Ω–≥ –ø–æ 100 —Å–æ–±—ã—Ç–∏–π)
- –î–ª—è –æ—á–µ–Ω—å –±–æ–ª—å—à–∏—Ö —Ñ–∞–π–ª–æ–≤ –º–æ–∂–Ω–æ —É–≤–µ–ª–∏—á–∏—Ç—å `BATCH_SIZE` –≤ `services.py`

---

## ‚úÖ –ò—Ç–æ–≥–æ–≤—ã–π –æ—Ç–≤–µ—Ç

**–î–∞, –≤–∞—à–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –ë–£–î–ï–¢ –≤—ã–ø–æ–ª–Ω—è—Ç—å –Ω—É–∂–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏, –Ω–æ —Å –Ω–µ–±–æ–ª—å—à–∏–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏:**

1. ‚úÖ **Docker –≤ –õ–í–°** - —Ä–∞–±–æ—Ç–∞–µ—Ç, –æ–±—Ä–∞–∑—ã –Ω—É–∂–Ω–æ —Å–æ–±—Ä–∞—Ç—å –æ–¥–∏–Ω —Ä–∞–∑ —Å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–æ–º
2. ‚úÖ **PostgreSQL** - –ø–æ–ª–Ω–æ—Å—Ç—å—é –Ω–∞—Å—Ç—Ä–æ–µ–Ω
3. ‚úÖ **–ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞** - —Ä–∞–±–æ—Ç–∞–µ—Ç, –Ω—É–∂–Ω–æ —Ç–æ–ª—å–∫–æ –ø—Ä–∏–º–æ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å Windows-—à–∞—Ä—É
4. ‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞** - watcher —Å–ª–µ–¥–∏—Ç –∑–∞ –∫–∞—Ç–∞–ª–æ–≥–æ–º –∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Ñ–∞–π–ª—ã

**–ß—Ç–æ –Ω—É–∂–Ω–æ —Å–¥–µ–ª–∞—Ç—å:**
- –°–º–æ–Ω—Ç–∏—Ä–æ–≤–∞—Ç—å Windows-—à–∞—Ä—É –Ω–∞ Linux —Ö–æ—Å—Ç–µ
- –û–±–Ω–æ–≤–∏—Ç—å `docker-compose.yml` –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è bind mount –≤–º–µ—Å—Ç–æ volume
- –°–æ–±—Ä–∞—Ç—å –æ–±—Ä–∞–∑—ã –Ω–∞ –º–∞—à–∏–Ω–µ —Å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç–æ–º –∏ —Å–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å –Ω–∞ —Ü–µ–ª–µ–≤—É—é
- –ù–∞—Å—Ç—Ä–æ–∏—Ç—å `.env` —Ñ–∞–π–ª

**–í—Å–µ –æ—Å—Ç–∞–ª—å–Ω–æ–µ —É–∂–µ —Ä–∞–±–æ—Ç–∞–µ—Ç!** üéâ



